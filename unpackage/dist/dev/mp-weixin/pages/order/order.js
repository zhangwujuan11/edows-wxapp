(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/order"],{279:function(e,t,r){"use strict";(function(e,t){var n=r(4);r(26);n(r(25));var a=n(r(280));e.__webpack_require_UNI_MP_PLUGIN__=r,t(a.default)}).call(this,r(1)["default"],r(2)["createPage"])},280:function(e,t,r){"use strict";r.r(t);var n=r(281),a=r(283);for(var o in a)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(o);r(285);var s,i=r(34),c=Object(i["default"])(a["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],s);c.options.__file="pages/order/order.vue",t["default"]=c.exports},281:function(e,t,r){"use strict";r.r(t);var n=r(282);r.d(t,"render",(function(){return n["render"]})),r.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),r.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),r.d(t,"components",(function(){return n["components"]}))},282:function(e,t,r){"use strict";var n;r.r(t),r.d(t,"render",(function(){return a})),r.d(t,"staticRenderFns",(function(){return s})),r.d(t,"recyclableRender",(function(){return o})),r.d(t,"components",(function(){return n}));try{n={uniLoadMore:function(){return r.e("components/uni-load-more/uni-load-more").then(r.bind(null,826))}}}catch(i){if(-1===i.message.indexOf("Cannot find module")||-1===i.message.indexOf(".vue"))throw i;console.error(i.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var e=this,t=e.$createElement,r=(e._self._c,e.__map(e.navList,(function(t,r){var n=e.__get_orig(t),a=!0===t.loaded&&0===t.orderList.length,o=e.__map(t.orderList,(function(t,r){var n=e.__get_orig(t),a=t.productList.length,o=t.productList.length;return{$orig:n,g1:a,g2:o}}));return{$orig:n,g0:a,l0:o}})));e.$mp.data=Object.assign({},{$root:{l1:r}})},o=!1,s=[];a._withStripped=!0},283:function(e,t,r){"use strict";r.r(t);var n=r(284),a=r.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},284:function(e,t,r){"use strict";(function(e,n){var a=r(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(r(61)),s=a(r(63)),i=a(r(11)),c=r(28);a(r(38));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d=function(){r.e("components/uni-load-more/uni-load-more").then(function(){return resolve(r(826))}.bind(null,r)).catch(r.oe)},f=function(){r.e("components/empty").then(function(){return resolve(r(833))}.bind(null,r)).catch(r.oe)},p={components:{uniLoadMore:d,empty:f},computed:l({},(0,c.mapState)(["hasLogin","userInfo"])),data:function(){return{res:{},serviceNo:"400-988-6868",tabCurrentIndex:0,orderStatus:"",orderList:[],pageNo:1,pageSize:10,totalPage:0,refundDetailVO:[],seviceClass:"none",shareCouponOrderList:[],optsType:"",navList:[{state:0,text:"全部",textSpec:"全部",orderStatus:"",loadingType:"more",orderList:[]},{state:1,text:"待付款",textSpec:"已下单",loadingType:"more",orderStatus:"101",orderList:[]},{state:2,text:"待收货",textSpec:"待收货",loadingType:"more",orderStatus:"102",orderList:[]},{state:3,text:"已完成",textSpec:"已完成",loadingType:"more",orderStatus:"107",orderList:[]}],allSelect:!1,totalPrice:0,orderSnList:[],accountType:0,isOffline:0}},onLoad:function(t){var r=getCurrentPages()[0].route;console.log("当前路由：",r),this.hasLogin||e.reLaunch({url:"/pages/wxAuth/wxAuth?returnUrl="+r}),console.log(t.state),this.isOffline=e.getStorageSync("userInfo").isOffline?e.getStorageSync("userInfo").isOffline:0,this.accountType=e.getStorageSync("userInfo").accountType?e.getStorageSync("userInfo").accountType:0,this.tabCurrentIndex=+t.state,0==t.state&&this.loadData()},methods:{getData:function(t,r){var n=this;return(0,s.default)(o.default.mark((function a(){var s,i,c;return o.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n.res={},s={orderStatus:t,pageNo:n.pageNo,pageSize:n.pageSize},a.next=4,n.$axios(n.$baseUrl.getOrderList,JSON.stringify(s));case 4:for(c in i=a.sent,i.data.data)i.data.data[c].flagSel=!1;n.res=i,1==n.pageNo&&(n.totalPage=n.res.data.pages),n.orderList=n.res.data.data.filter((function(e){return e=Object.assign(e,n.orderStateExp(e.orderStatus)),""===t?e:"102"===t?"102"===e.orderStatus||"103"===e.orderStatus:e.orderStatus===t})),n.orderList.forEach((function(e){r.orderList.push(e)})),n.$set(r,"loaded",!0),n.pageNo>=n.totalPage?(e.stopPullDownRefresh(),n.pageNo=n.totalPage+1,r.loadingType="noMore"):(n.pageNo=n.pageNo+1,console.log(n.pageNo),n.getData(t,r),r.loadingType="more");case 12:case"end":return a.stop()}}),a)})))()},loadData:function(e){var t=this.tabCurrentIndex,r=this.navList[t],n=r.orderStatus;console.log("来源：",e),"tabChange"===e&&!0===r.loaded&&this.$set(r,"loaded",!1),"loading"!==r.loadingType&&(r.loadingType="loading",this.getData(n,r),setTimeout((function(){}),600))},changeTab:function(e){this.tabCurrentIndex=e.target.current,this.orderList=[],this.pageNo=1,this.totalPage=0;var t=this.tabCurrentIndex,r=this.navList[t];r.orderStatus;r.orderList=[],this.loadData("tabChange")},tabClick:function(e){this.tabCurrentIndex=e},selSet:function(e){e.flagSel=!e.flagSel;for(var t=this.navList[1].orderList,r=t.length,n=0,a=0;a<r;a++)t[a].flagSel&&(n+=1);console.log("订单长度：",r," 选中长度：",n),this.allSelect=r==n,this.calcTotal()},allSel:function(){if(this.allSelect){for(var e in this.navList[1].orderList)this.navList[1].orderList[e].flagSel=!1;this.allSelect=!1}else{for(var e in this.navList[1].orderList)this.navList[1].orderList[e].flagSel=!0;this.allSelect=!0}this.calcTotal()},calcTotal:function(){var e=this;this.orderSnList=[];var t=this.navList[1].orderList;if(0!==t.length){var r=0;t.forEach((function(t){!0===t.flagSel&&(r+=parseFloat(t.totalPrice),e.orderSnList.push(t.orderSn))})),this.totalPrice=r.toFixed(2),console.log("订单序号：",this.orderSnList)}},chackInfo:function(){return!!this.orderSnList.length||(this.$api.msg("请先选择订单号!"),!1)},toSettle:function(){e.navigateTo({url:"/pages/order/orderSettle?state=0"})},toggleService:function(){var e=this;"show"===this.seviceClass?(this.seviceClass="hide",setTimeout((function(){e.seviceClass="none"}),250)):"none"===this.seviceClass&&(this.seviceClass="show")},stopPrevent:function(){},toPay:function(e){var t=this;return(0,s.default)(o.default.mark((function r(){return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t,t.optsType="",t.shareCouponOrderList="",console.log(e),e.shareCoupon?(t.shareCouponOrderList=e.shareCouponOrderList,t.optsType="付款",t.toggleService()):t.toSurPay(e);case 5:case"end":return r.stop()}}),r)})))()},toSurPay:function(t){var r=this;return(0,s.default)(o.default.mark((function n(){var a,i,c,u;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a="",i=[],c=r,t.orderSn)a=t.orderSn,console.log(a);else{for(u in t)i.push(t[u].orderSn);a=i.join(","),console.log(a)}e.login({provider:"weixin",success:function(){var n=(0,s.default)(o.default.mark((function n(s){var i,u;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i={orderSn:a,openId:e.getStorageSync("openId")?e.getStorageSync("openId"):""},console.log(i),n.next=4,r.$axios(r.$baseUrl.orderPayer,i);case 4:u=n.sent,console.log("返回数据：",u.data.data),u.data.data.appId?e.requestPayment({provider:"wxpay",appId:u.data.data.appId,timeStamp:u.data.data.timeStamp,nonceStr:u.data.data.nonceStr,package:u.data.data.packageValue,signType:u.data.data.signType,paySign:u.data.data.paySign,success:function(r){e.redirectTo({url:"/pages/money/paySuccess?totalPrice="+t.totalPrice})},fail:function(e){c.$api.msg("支付失败"),console.log("fail:"+JSON.stringify(e))}}):"支付成功"==u.data.data&&(c.$api.msg(u.data.data),setTimeout((function(){e.redirectTo({url:"/pages/money/paySuccess?totalPrice="+t.totalPrice})}),1e3));case 7:case"end":return n.stop()}}),n)})));function i(e){return n.apply(this,arguments)}return i}()});case 5:case"end":return n.stop()}}),n)})))()},confirm:function(t){var r=this;return(0,s.default)(o.default.mark((function n(){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r,e.showModal({content:"确认已收货？",success:function(){var n=(0,s.default)(o.default.mark((function n(a){var s;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!a.confirm){n.next=6;break}return s={orderSn:t.orderSn},n.next=4,r.$axios(r.$baseUrl.orderConfirmation,s);case 4:n.sent,e.redirectTo({url:"/pages/order/order?state=3"});case 6:case"end":return n.stop()}}),n)})));function a(e){return n.apply(this,arguments)}return a}()});case 2:case"end":return n.stop()}}),n)})))()},refundOrder:function(t){e.navigateTo({url:"/pages/order/refund?orderSn="+t.orderSn})},refundOrderDetail:function(t){e.navigateTo({url:"/pages/order/refundDetail?orderSn="+t.orderSn})},makePhoneCall:function(){e.makePhoneCall({phoneNumber:this.serviceNo,success:function(){console.log("成功拨打电话")}})},toEvalu:function(t){e.navigateTo({url:"/pages/evaluate/evaluate?orderSn="+t.orderSn})},deleteOrder:function(t,r){var n=this;return(0,s.default)(o.default.mark((function a(){return o.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:e.showModal({content:"确认删除此订单？",success:function(){var e=(0,s.default)(o.default.mark((function e(a){var s,i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!a.confirm){e.next=6;break}return s={orderSn:r.orderSn},e.next=4,n.$axios(n.$baseUrl.deleteOrder,s);case 4:i=e.sent,200==i.data.code&&setTimeout((function(){n.navList[n.tabCurrentIndex].orderList.splice(t,1)}),600);case 6:case"end":return e.stop()}}),e)})));function a(t){return e.apply(this,arguments)}return a}()});case 1:case"end":return a.stop()}}),a)})))()},cancelOrder:function(e){var t=this;return(0,s.default)(o.default.mark((function r(){return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t,t.optsType="",t.shareCouponOrderList="",e.shareCoupon?(t.shareCouponOrderList=e.shareCouponOrderList,t.optsType="取消",t.toggleService()):t.cancelSurOrder(e);case 4:case"end":return r.stop()}}),r)})))()},cancelSurOrder:function(t){var r=this;return(0,s.default)(o.default.mark((function n(){var a,s,i,c,u;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.showLoading({title:"请稍后"}),console.log(t),a="",s=[],t.orderSn)a=t.orderSn,console.log(a);else{for(i in t)s.push(t[i].orderSn);a=s[0],console.log(a)}return c={orderSn:a},n.next=8,r.$axios(r.$baseUrl.cancelOrder,c);case 8:u=n.sent,200==u.data.code&&(r.seviceClass="hide",setTimeout((function(){if(r.seviceClass="none",t.orderSn){var n=r.orderStateExp(105),a=n.stateTip,o=n.stateTipColor;t=Object.assign(t,{orderStatus:105,stateTip:a,stateTipColor:o});var s=r.navList[1].orderList,i=s.findIndex((function(e){return e.id===t.id}));-1!==i&&s.splice(i,1)}else e.navigateTo({url:"/pages/order/order?state=0"});e.hideLoading()}),600));case 10:case"end":return n.stop()}}),n)})))()},orderStateExp:function(e){var t="",r="#fa436a";switch(+e){case 101:t=3==this.accountType?"已下单":"待付款";break;case 102:t="已付款",r="#339cfe";break;case 103:t="已发货",r="#339cfe";break;case 104:t="已签收",r="#339cfe";break;case 105:t="已取消",r="#909399";break;case 106:t="已退款",r="#333333";break;case 107:t="已完成",r="#339cfe";break;case 108:t="退款中",r="#333333";break;case 109:t="退款拒绝",r="#f04c41";break}return{stateTip:t,stateTipColor:r}},toOffline:function(e){var t=this;return(0,s.default)(o.default.mark((function r(){var n,a,s,i,c,u;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t,a="",s=[],e.orderSn)a=e.orderSn;else{for(i in e)s.push(e[i].orderSn);a=s.join(","),console.log(a)}return c={orderSn:a,pzImg:e.pzImg},r.next=7,n.$axios(n.$baseUrl.offlinePay,c);case 7:u=r.sent,200==u.data.code&&(n.$api.msg("提交成功"),setTimeout((function(){n.onLoad()}),1600));case 9:case"end":return r.stop()}}),r)})))()},upload:function(t){var r=this;e.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){console.log(e,0);e.tempFilePaths;n.getFileSystemManager().readFile({filePath:e.tempFilePaths[0],encoding:"base64",success:function(){var e=(0,s.default)(o.default.mark((function e(n){var a,s,i,c;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a="data:image/png;base64,"+n.data,console.log(n,1),s={base64Data:a,bizType:0},e.next=5,r.$axios(r.$baseUrl.uploadPic,s);case 5:i=e.sent,c=i.data,console.log(c),200==c.code&&(t.pzImg=c.data.webPath,setTimeout((function(){r.toOffline(t)}),300));case 9:case"end":return e.stop()}}),e)})));function n(t){return e.apply(this,arguments)}return n}()})},error:function(e){console.log(e)}})}}};t.default=p}).call(this,r(2)["default"],r(1)["default"])},285:function(e,t,r){"use strict";r.r(t);var n=r(286),a=r.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},286:function(e,t,r){}},[[279,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/order/order.js.map