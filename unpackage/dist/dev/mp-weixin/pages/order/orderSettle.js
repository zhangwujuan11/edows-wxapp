(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/orderSettle"],{287:function(e,t,r){"use strict";(function(e,t){var n=r(4);r(26);n(r(25));var a=n(r(288));e.__webpack_require_UNI_MP_PLUGIN__=r,t(a.default)}).call(this,r(1)["default"],r(2)["createPage"])},288:function(e,t,r){"use strict";r.r(t);var n=r(289),a=r(291);for(var o in a)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(o);r(293);var i,s=r(34),c=Object(s["default"])(a["default"],n["render"],n["staticRenderFns"],!1,null,null,null,!1,n["components"],i);c.options.__file="pages/order/orderSettle.vue",t["default"]=c.exports},289:function(e,t,r){"use strict";r.r(t);var n=r(290);r.d(t,"render",(function(){return n["render"]})),r.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),r.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),r.d(t,"components",(function(){return n["components"]}))},290:function(e,t,r){"use strict";var n;r.r(t),r.d(t,"render",(function(){return a})),r.d(t,"staticRenderFns",(function(){return i})),r.d(t,"recyclableRender",(function(){return o})),r.d(t,"components",(function(){return n}));try{n={uniLoadMore:function(){return r.e("components/uni-load-more/uni-load-more").then(r.bind(null,826))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var e=this,t=e.$createElement,r=(e._self._c,e.__map(e.navList,(function(t,r){var n=e.__get_orig(t),a=!0===t.loaded&&0===t.orderList.length,o=0==e.tabCurrentIndex?e.__map(t.orderList,(function(t,r){var n=e.__get_orig(t),a=t.productList.length,o=t.productList.length;return{$orig:n,g1:a,g2:o}})):null;return{$orig:n,g0:a,l0:o}})));e.$mp.data=Object.assign({},{$root:{l1:r}})},o=!1,i=[];a._withStripped=!0},291:function(e,t,r){"use strict";r.r(t);var n=r(292),a=r.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},292:function(e,t,r){"use strict";(function(e){var n=r(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(61)),o=n(r(63)),i=n(r(11)),s=r(28),c=r(179);n(r(38));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=function(){r.e("components/uni-load-more/uni-load-more").then(function(){return resolve(r(826))}.bind(null,r)).catch(r.oe)},f=function(){r.e("components/empty").then(function(){return resolve(r(833))}.bind(null,r)).catch(r.oe)},p={components:{uniLoadMore:l,empty:f},computed:d({},(0,s.mapState)(["hasLogin","userInfo"])),data:function(){return{res:{},serviceNo:"400-988-6868",tabCurrentIndex:0,orderStatus:"",orderList:[],pageNo:1,pageSize:10,totalPage:0,accountBalance:0,refundDetailVO:[],navList:[{state:0,text:"待结算",orderStatus:"",loadingType:"more",orderList:[]},{state:1,text:"结算中",loadingType:"more",orderStatus:"101",orderList:[]},{state:2,text:"已结算",loadingType:"more",orderStatus:"102",orderList:[]}],allSelect:!1,totalPrice:0,orderSnList:[],accountType:0}},onLoad:function(t){var r=getCurrentPages()[0].route;console.log("当前路由：",r),this.hasLogin||e.reLaunch({url:"/pages/wxAuth/wxAuth?returnUrl="+r}),console.log(t.state),this.accountType=e.getStorageSync("userInfo").accountType?e.getStorageSync("userInfo").accountType:0,this.tabCurrentIndex=+t.state,0==t.state&&this.loadData()},methods:{getData:function(t,r){var n=this;return(0,o.default)(a.default.mark((function o(){var i,s,u,d,l;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n.res={},console.log(n.tabCurrentIndex),0!=n.tabCurrentIndex){a.next=10;break}return i={orderStatus:t,pageNo:n.pageNo,pageSize:n.pageSize},a.next=6,n.$axios(n.$baseUrl.getDjsOrderList,JSON.stringify(i));case 6:for(u in s=a.sent,s.data.data.length&&(n.accountBalance=s.data.data[0].accountBalance?s.data.data[0].accountBalance:0),s.data.data)s.data.data[u].flagSel=!1;n.res=s;case 10:if(0==n.tabCurrentIndex){a.next=18;break}return d=1==n.tabCurrentIndex?1:2,i={settleStatus:d,pageNo:n.pageNo,pageSize:n.pageSize},a.next=15,n.$axios(n.$baseUrl.getOrderAccountList,JSON.stringify(i));case 15:for(u in l=a.sent,n.res=l,n.res.data.data)n.res.data.data[u].createDate=c.fn.formatTime(n.res.data.data[u].createDate,"Y-M-D");case 18:1==n.pageNo&&(n.totalPage=n.res.data.pages),n.orderList=n.res.data.data,n.orderList.forEach((function(e){r.orderList.push(e)})),n.$set(r,"loaded",!0),n.pageNo>=n.totalPage?(e.stopPullDownRefresh(),n.pageNo=n.totalPage+1,r.loadingType="noMore"):(n.pageNo=n.pageNo+1,console.log(n.pageNo),n.getData(t,r),r.loadingType="more");case 23:case"end":return a.stop()}}),o)})))()},loadData:function(e){var t=this.tabCurrentIndex,r=this.navList[t],n=r.orderStatus;console.log("来源：",e),"tabChange"===e&&!0===r.loaded&&this.$set(r,"loaded",!1),"loading"!==r.loadingType&&(r.loadingType="loading",this.getData(n,r),setTimeout((function(){}),600))},changeTab:function(e){this.tabCurrentIndex=e.target.current,this.orderList=[],this.pageNo=1,this.totalPage=0;var t=this.tabCurrentIndex,r=this.navList[t];r.orderStatus;r.orderList=[],this.allSelect=!1,this.loadData("tabChange")},tabClick:function(e){this.tabCurrentIndex=e},selSet:function(e){e.flagSel=!e.flagSel;for(var t=this.navList[0].orderList,r=t.length,n=0,a=0;a<r;a++)t[a].flagSel&&(n+=1);console.log("订单长度：",r," 选中长度：",n),this.allSelect=r==n,this.calcTotal()},allSel:function(){if(this.allSelect){for(var e in this.navList[0].orderList)this.navList[0].orderList[e].flagSel=!1;this.allSelect=!1}else{for(var e in this.navList[0].orderList)this.navList[0].orderList[e].flagSel=!0;this.allSelect=!0}this.calcTotal()},calcTotal:function(){var e=this;this.orderSnList=[];var t=this.navList[0].orderList;if(0!==t.length){var r=0;t.forEach((function(t){!0===t.flagSel&&(r+=parseFloat(t.totalPrice),e.orderSnList.push(t.orderSn))})),this.totalPrice=r.toFixed(2),console.log("订单序号：",this.orderSnList)}},toSettleDetail:function(t){e.navigateTo({url:"/pages/order/settleDetail?accountSn="+t.accountSn})},chackInfo:function(){return!!this.orderSnList.length||(this.$api.msg("请先选择订单号!"),!1)},toSettle:function(){if(!this.chackInfo())return!1;e.navigateTo({url:"/pages/order/toSettle?orderSnList="+this.orderSnList.join(",")})},toPay:function(t){var r=this;return(0,o.default)(a.default.mark((function n(){var i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:i=r,e.login({provider:"weixin",success:function(){var n=(0,o.default)(a.default.mark((function n(o){var s,c;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s={orderSn:t.orderSn,openId:e.getStorageSync("openId")?e.getStorageSync("openId"):""},console.log(s),n.next=4,r.$axios(r.$baseUrl.orderPayer,s);case 4:c=n.sent,console.log("返回数据：",c.data.data),e.requestPayment({provider:"wxpay",appId:c.data.data.appId,timeStamp:c.data.data.timeStamp,nonceStr:c.data.data.nonceStr,package:c.data.data.packageValue,signType:c.data.data.signType,paySign:c.data.data.paySign,success:function(r){e.redirectTo({url:"/pages/money/paySuccess?totalPrice="+t.totalPrice})},fail:function(e){i.$api.msg("支付失败"),console.log("fail:"+JSON.stringify(e))}});case 7:case"end":return n.stop()}}),n)})));function s(e){return n.apply(this,arguments)}return s}()});case 2:case"end":return n.stop()}}),n)})))()},confirm:function(t){var r=this;return(0,o.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r,e.showModal({content:"确认已收货？",success:function(){var n=(0,o.default)(a.default.mark((function n(o){var i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!o.confirm){n.next=6;break}return i={orderSn:t.orderSn},n.next=4,r.$axios(r.$baseUrl.orderConfirmation,i);case 4:n.sent,e.redirectTo({url:"/pages/order/order?state=3"});case 6:case"end":return n.stop()}}),n)})));function i(e){return n.apply(this,arguments)}return i}()});case 2:case"end":return n.stop()}}),n)})))()},refundOrder:function(t){e.navigateTo({url:"/pages/order/refund?orderSn="+t.orderSn})},refundOrderDetail:function(t){e.navigateTo({url:"/pages/order/refundDetail?orderSn="+t.orderSn})},makePhoneCall:function(){e.makePhoneCall({phoneNumber:this.serviceNo,success:function(){console.log("成功拨打电话")}})},toEvalu:function(t){e.navigateTo({url:"/pages/evaluate/evaluate?orderSn="+t.orderSn})},deleteOrder:function(t,r){var n=this;return(0,o.default)(a.default.mark((function i(){return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:e.showModal({content:"确认删除此订单？",success:function(){var e=(0,o.default)(a.default.mark((function e(o){var i,s;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!o.confirm){e.next=6;break}return i={orderSn:r.orderSn},e.next=4,n.$axios(n.$baseUrl.deleteOrder,i);case 4:s=e.sent,200==s.data.code&&setTimeout((function(){n.navList[n.tabCurrentIndex].orderList.splice(t,1)}),600);case 6:case"end":return e.stop()}}),e)})));function i(t){return e.apply(this,arguments)}return i}()});case 1:case"end":return i.stop()}}),i)})))()},cancelOrder:function(t){var r=this;return(0,o.default)(a.default.mark((function n(){var o,i;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.showLoading({title:"请稍后"}),console.log(t),o={orderSn:t.orderSn},n.next=5,r.$axios(r.$baseUrl.cancelOrder,o);case 5:i=n.sent,200==i.data.code&&setTimeout((function(){var n=r.orderStateExp(105),a=n.stateTip,o=n.stateTipColor;t=Object.assign(t,{orderStatus:105,stateTip:a,stateTipColor:o});var i=r.navList[1].orderList,s=i.findIndex((function(e){return e.id===t.id}));-1!==s&&i.splice(s,1),e.hideLoading()}),600);case 7:case"end":return n.stop()}}),n)})))()},orderStateExp:function(e){var t="",r="#fa436a";switch(+e){case 101:t="待付款";break;case 102:t="已付款",r="#339cfe";break;case 103:t="已发货",r="#339cfe";break;case 104:t="已签收",r="#339cfe";break;case 105:t="已取消",r="#909399";break;case 106:t="已退款",r="#333333";break;case 107:t="已完成",r="#339cfe";break;case 108:t="退款中",r="#333333";break;case 109:t="退款拒绝",r="#f04c41";break}return{stateTip:t,stateTipColor:r}}}};t.default=p}).call(this,r(2)["default"])},293:function(e,t,r){"use strict";r.r(t);var n=r(294),a=r.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},294:function(e,t,r){}},[[287,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/order/orderSettle.js.map